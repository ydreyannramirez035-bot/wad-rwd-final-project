-- Create a Database
CREATE DATABASE userDB;
USE userDB;

-- PARENT TABLE 1: Roles
CREATE TABLE Roles (
    id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE,
    description VARCHAR(255),
    PRIMARY KEY (id)
);

-- PARENT TABLE 2: Departments 
CREATE TABLE Departments (
    id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL UNIQUE,
    PRIMARY KEY (id)
);

-- PARENT TABLE 3: Courses 
CREATE TABLE Courses (
    id INT NOT NULL AUTO_INCREMENT,
    courseCode VARCHAR(10) NOT NULL UNIQUE,
    courseName VARCHAR(255) NOT NULL,
    departmentId INT NOT NULL,
    PRIMARY KEY (id),
    
    CONSTRAINT fk_course_dept
        FOREIGN KEY (departmentId) REFERENCES Departments(id)
);

-- PARENT TABLE 4: Users (Centralized Login)
CREATE TABLE Users (
    id INT NOT NULL AUTO_INCREMENT,
    roleId INT,
    username VARCHAR(255) NOT NULL UNIQUE,
    passwordHash VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    PRIMARY KEY (id),

    CONSTRAINT fk_role
        FOREIGN KEY (roleId) REFERENCES Roles(id)
);

-- INFO TABLE: Admins (Child of Users)
CREATE TABLE Admins (
    id INT NOT NULL AUTO_INCREMENT,
    userId INT NOT NULL UNIQUE,
    name VARCHAR(255) NOT NULL, 
    position VARCHAR(255),
    PRIMARY KEY (id),

    CONSTRAINT fk_admin_user
        FOREIGN KEY (userId) REFERENCES Users(id)
);

-- INFO TABLE: Teachers 
CREATE TABLE Teachers (
    id INT NOT NULL AUTO_INCREMENT,
    userId INT NOT NULL UNIQUE, 
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE,
    PRIMARY KEY (id),
    
    CONSTRAINT fk_teacher_user 
        FOREIGN KEY (userId) REFERENCES Users(id)
);

-- JUNCTION TABLE: TeacherDepartments (Many-to-Many Assignment)
CREATE TABLE TeacherDepartments (
    teacherId INT NOT NULL,
    departmentId INT NOT NULL,
    PRIMARY KEY (teacherId, departmentId),

    CONSTRAINT fk_td_teacher
        FOREIGN KEY (teacherId) REFERENCES Teachers(id),
        
    CONSTRAINT fk_td_dept
        FOREIGN KEY (departmentId) REFERENCES Departments(id)
);

-- INFO TABLE: Students (Child of Users)
CREATE TABLE Students (
    id INT NOT NULL AUTO_INCREMENT,
    userId INT NOT NULL UNIQUE,
    studentNumber VARCHAR(50) NOT NULL UNIQUE,
    name VARCHAR(255) NOT NULL,
    gender VARCHAR(50), 
    age INT,
    courseId INT NOT NULL,
    yearLevel INT,
    email VARCHAR(255) UNIQUE,
    PRIMARY KEY (id),

    CONSTRAINT fk_student_user
        FOREIGN KEY (userId) REFERENCES Users(id),

    CONSTRAINT fk_student_course
        FOREIGN KEY (courseId) REFERENCES Courses(id)
);

-- INDEPENDENT TABLE: Schedules 
CREATE TABLE Schedules (
    id INT NOT NULL AUTO_INCREMENT,
    subject VARCHAR (255) NOT NULL,
    teacherId INT NOT NULL, 
    room VARCHAR (10),
    timeStart TIME,
    timeEnd TIME,
    PRIMARY KEY (id), 
    
    CONSTRAINT fk_schedule_teacher
        FOREIGN KEY (teacherId) REFERENCES Teachers(id)
);

-- JUNCTION TABLE: StudentSchedules (Many-to-Many Enrollment)
CREATE TABLE StudentSchedules (
    userId INT NOT NULL,
    scheduleId INT NOT NULL,
    PRIMARY KEY (userId, scheduleId),

    CONSTRAINT fk_schedule_user
        FOREIGN KEY (userId) REFERENCES Users(id),
    
    CONSTRAINT fk_schedule_ref
        FOREIGN KEY (scheduleId) REFERENCES Schedules(id)
);